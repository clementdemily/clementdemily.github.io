<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Créer un serveur postgresql sur microsoft azure</title>
	
	<meta name="author" content="Clément Demily">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

	<link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/clementdemily">
				<i class="fa fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="http://twitter.com/demily_clement">
				<i class="fa fa-twitter"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:demily.clement+blog@gmail.com">
				<i class="fa fa-envelope"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="https://fr.linkedin.com/in/clementdemily">
				<i class="fa fa-linkedin fa-lg"></i>
			</a>
			


			<a class="navbar-brand" href="/">
				<img src="http://www.gravatar.com/avatar/a4c48bb0b9e041ad0a5299f82b2b16d9?s=35" class="img-circle" />
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/categories.html">Catégories</a></li>
				<li><a href="/tags.html">Tags</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="/categories.html"><i class="fa fa-folder"></i>Catégories</a></li>
			<li><a href="/tags.html"><i class="fa fa-tags"></i>Tags</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Haut de page</a></li>
		</ul>
	</div>

	<div class="col-sm-3 sidebar hidden-xs">
		<!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/">
		<img src="http://www.gravatar.com/avatar/a4c48bb0b9e041ad0a5299f82b2b16d9?s=150" class="img-circle" />
	</a>
	<h3 class="title">
    <a href="/">Clément Demily</a>
  </h3>
</header>


<div id="bio" class="text-center">
	Notes d'un développeur
</div>


<div id="pages-list" class="text-center">
	<ul>
		<li>
			<a href="/portfolio/" title="portfolio">Portfolio</a>
		</li>
		<li> | </li>
		<li>
			<a href="/cv/" title="cv">CV</a>
		</li>
	</ul>	
</div>

<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/clementdemily">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/demily_clement">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:demily.clement+blog@gmail.com">
				<i class="fa fa-envelope fa-lg"></i>
			</a>
		</li>
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://fr.linkedin.com/in/clementdemily">
				<i class="fa fa-linkedin fa-lg"></i>
			</a>
		</li>
		
		<li>
			<a class="btn btn-default btn-sm" href="/">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
</div>

<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
  <h1>Créer un serveur postgresql sur microsoft azure </h1>
</div>
	
<article>

	<div class="col-sm-10">
	 <span class="post-date">
	   
	   October 
	   15th,
	   
	   2015
	 </span>
	  <div class="article_body">
	  <h2 id="création-et-configuration-de-linstance">Création et configuration de l’instance</h2>

<p>Rendez-vous sur le <a href="https://portal.azure.com">portail azure</a>
Pour cet exemple, j’ai choisi de prendre une image ubuntu.</p>

<p><img src="/img/2015/10/create-instance.png" alt="create-instance" class="center-image" /></p>

<p>Une fois l’instance créée, vous pourrez consulter les informations de celle-ci:</p>

<p><img src="/img/2015/10/instance-details.png" alt="instance-details" class="center-image" /></p>

<p>Le champ qui nous intéresse ici est Virtual IP address.</p>

<p>Nous devons ensuite exposer un port de notre instance, pour cela, cliquer sur “All setting”, puis sur “Endpoints”.
Ajouter un nouveau champs correspondant aux ports que vous voulez exposé.
J’ai choisi d’exposer le port part défaut de postgresql (5432), mais libre a vous de choisir le port que vous désirez.</p>

<p><img src="/img/2015/10/open-port.png" alt="open-port" class="center-image" /></p>

<h2 id="connexion-à-la-machine-et-installation-des-packages">Connexion à la machine et installation des packages</h2>

<p>Une fois l’instance créée et configurée, vous pourrez vous connecter en SSH à l’aide la commande suivante:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="se">\$</span><span class="o">&gt;</span> ssh username@ip</code></pre></figure>

<p>Téléchargeons le package postgresql (9.3) ainsi que les extensions correspondantes:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">username@ip&gt; <span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> postgresql postgresql-contrib-9.3</code></pre></figure>

<h2 id="création-des-données-de-tests">Création des données de tests</h2>

<p>Créons un nouvel utilisateur et une nouvelle base de donnée:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">username@ip&gt; <span class="nb">sudo</span> <span class="nt">-u</span> postgres createuser <span class="nt">-r</span> <span class="nt">-d</span> <span class="nt">-s</span> my_user
username@ip&gt; createdb my_new_db
username@ip&gt; <span class="nb">echo</span> <span class="s2">"ALTER ROLE my_user WITH ENCRYPTED PASSWORD 'password';"</span> | psql my_new_db</code></pre></figure>

<h2 id="configuration-de-postgresql">Configuration de postgresql</h2>

<p>Nous devons définir des règles d’accès dans le fichier pg_hba.conf. (/etc/postgresql/9.3/main/pg_hba.conf)
Le fichier de configuration est plutôt clair et les commentaires expliquent bien le formatage de la configuration.</p>

<p>Pour mon exemple, my_user et my_new_db correspond à l’utilisateur et à la base de données que venons de créer.
La valeur <strong>IP_MACHINE_CLIENT</strong> doit être remplacée par l’adresse IP de la machine que vous voulez utiliser pour vous connecter à votre base de données.</p>

<p>Cette commande permettra de configurer le fichier sans l’éditer.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">username@ip&gt; <span class="nb">sudo echo</span> <span class="s2">"host my_new_db my_user IP_MACHINE_CLIENT/24 trust"</span> <span class="o">&gt;&gt;</span> /etc/postgresql/9.3/main/pg_hba.conf</code></pre></figure>

<p>Nous devons configurer postgresql pour qu’il écoute d’autre adresse que localhost.
Pour cela, nous devons trouver le champ “listen_address” dans le fichier postgresql.conf. ( /etc/postgresql/9.3/main/postgresql.conf)
Comme expliqué dans le fichier, vous pouvez utiliser plusieurs valeurs séparées par une virgule.
Dans cet exemple, j’utilise la valeur ‘*’ pour écouter toutes les adresses.</p>

<p>C’est également dans ce fichier que vous pourrez modifier le port d’écoute de postgresql.</p>

<p>Le champ “listen_address” est commenté par défaut (9.3), cette commande permettra de configurer le fichier sans l’éditer.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">username@ip&gt; <span class="nb">sudo echo</span> ‘listen_address<span class="o">=</span><span class="s2">"</span><span class="se">\*</span><span class="s2">"</span><span class="s1">' &gt;&gt; /etc/postgresql/9.3/main/postgresql.conf</span></code></pre></figure>

<p>Pour finir, nous devons redémarrer le service:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">username@ip&gt; <span class="nb">sudo </span>service postgresql restart</code></pre></figure>

<h2 id="test">Test</h2>

<p>Depuis votre machine (celle qui a l’IP <strong>IP_MACHINE_CLIENT</strong>), vous pourrez vous connecter à l’aide de la commande suivante:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">IP_MACHINE_CLIENT&gt; psql <span class="nt">-h</span> IP_INSTANCE_DB <span class="nt">-p</span> 5432 <span class="nt">-u</span> my_new_db my_user</code></pre></figure>

<p>IP_INSTANCE_DB correspond à l’IP de votre instance serveur postgresql, celle que nous avons créé au début de cet article.</p>

	  </div>

		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			 
				<li><a href="/categories.html#tutoriel-ref">
					tutoriel <span>(32)</span>
					,
				</a></li>
			 
				<li><a href="/categories.html#microsoft azure-ref">
					microsoft azure <span>(2)</span>
					
				</a></li>
			
		  
		</ul>
		  

		
		<ul class="list-inline">
		  <li><i class="fa fa-tags"></i></li>
		  
		  
			 
				<li>
					<a href="/tags.html#cloud-ref">
					cloud <span>(2)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#postgresql-ref">
					postgresql <span>(2)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#unix-ref">
					unix <span>(2)</span>
					
					</a>
				</li>
			
		  
		  
		</ul>
		  

		<hr>

		<div>
      <section class="share col-sm-6">
        <h4 class="section-title">Partager cet article</h4>
        <a class="btn btn-default btn-sm twitter" href="http://twitter.com/share?text=Créer un serveur postgresql sur microsoft azure&via=demily_clement"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
        </a>

        <a class="btn btn-default btn-sm linkedin"
           onclick="window.open('https://www.linkedin.com/cws/share?url='+window.location.href, 'linkedin-share', 'width=490,height=530');return false;">
          <i class="fa fa-linkedin fa-lg"></i>
        </a>

        <a class="btn btn-default btn-sm linkedin" href="mailto:?subject=Article sur clement-demily.fr: Créer un serveur postgresql sur microsoft azure&body=http://localhost:4000/2015/10/15/creer-un-serveur-postgresql-sur-microsoft-azure.html">
          <i class="fa fa-envelope fa-lg"></i>
        </a>
      </section>

      <section class="col-sm-6 author">
        <img src="http://www.gravatar.com/avatar/a4c48bb0b9e041ad0a5299f82b2b16d9" class="img-rounded author-image" />
        <h4 class="section-title author-name">Clément Demily</h4>
        <p class="author-bio">Développeur Lillois</p>
      </section>
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="/2015/09/11/installer-elixir-sur-mac.html" title="Installer Elixir sur mac">&larr; Précedent</a></li>
		  
		  
		  <li class="next"><a href="/2015/10/15/migrer-aws-s3-azure-blob.html" title="Migrer de Amazon Web Service S3 vers Microsoft Azure Blob">Suivant &rarr;</a></li>
		  
		</ul>

		<hr />

    <div id="disqus_thread"></div>

    <script type="text/javascript">
        var disqus_shortname = 'zendev';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>

    <noscript>
      Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
    </noscript>


	</div>
	
	<div class="col-sm-2 sidebar-2">
	
	</div>
</article>
<div class="clearfix"></div>



		<footer>
			<hr/>
			<p>
				<a href="/mentions-legales/" title="mentions-legales">Mentions légales</a>
				|
				<a href="/about/" title="about">À propos</a>
				<br />
				&copy; 2019 Clément Demily powered by <a href="http://jekyllrb.com" rel="nofollow" class="jekyll-link">Jekyll</a>.
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>

	<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'zendev';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
	</script>

	<script type="text/javascript">
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-47963410-1', 'auto');
	  ga('send', 'pageview');
	</script>

</body>
</html>

